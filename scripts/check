#!/bin/sh

set -eu

panic() {
  echo "$1" >&2
  exit 1
}

root="$(git rev-parse --show-toplevel)"
cd "$root"

if git status --porcelain -unormal | grep .; then
  panic "there are uncommitted changes"
fi

cd "$root"

if ! RUSTFLAGS="-D warnings" cargo check --quiet; then
  panic "cargo check failed"
fi
